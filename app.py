# app.py
from flask import Flask, request, jsonify import os import requests import json from datetime import datetime import random app = Flask(__name__) # ConfiguraÃ§Ãµes FACEBOOK_ACCESS_TOKEN = os.environ.get('FACEBOOK_ACCESS_TOKEN') WEBHOOK_VERIFY_TOKEN = os.environ.get('WEBHOOK_VERIFY_TOKEN', 'DANY_WEBHOOK_2024') WHATSAPP_NUMBER = os.environ.get('WHATSAPP_NUMBER', '5511970241011') # Links de afiliado AFFILIATE_LINKS = { 'sb2_turbo': 'https://mmecoserv.com/sb2turbo', 'sb2_black': 'https://mmecoserv.com/sb2black' } # Personalidade da Dany DANY_PERSONALITY = { 'name': 'Dany', 'role': 'Especialista em Emagrecimento e Coach de Bem-estar', 'tone': 'amigÃ¡vel, motivadora e profissional', 'expertise': 'produtos naturais para emagrecimento, SB2 Turbo e SB2 Black' } # FunÃ§Ã£o para log def log_message(message, level="INFO"): timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S") print(f"[{timestamp}] [{level}] {message}") # FunÃ§Ã£o para enviar mensagem via WhatsApp def send_whatsapp_message(recipient, message): url = f"https://graph.facebook.com/v18.0/{WHATSAPP_NUMBER}/messages" headers = { 'Authorization': f'Bearer {FACEBOOK_ACCESS_TOKEN}', 'Content-Type': 'application/json' } data = { 'messaging_product': 'whatsapp', 'to': recipient, 'type': 'text', 'text': {'body': message} } try: response = requests.post(url, headers=headers, json=data) response.raise_for_status() log_message(f"Mensagem enviada para {recipient}: {response.status_code}") return response.json() except Exception as e: log_message(f"Erro ao enviar mensagem: {str(e)}", "ERROR") return None # FunÃ§Ã£o para processar mensagens da Dany def process_dany_message(sender, message_text): """Processa mensagens e gera respostas da Dany""" message_lower = message_text.lower() # SaudaÃ§Ã£o inicial if any(word in message_lower for word in ['oi', 'olÃ¡', 'ola', 'hey', 'bom dia', 'boa tarde', 'boa noite']): return f"""OlÃ¡! ğŸ‘‹ Eu sou a Dany, sua especialista em emagrecimento! ğŸŒŸ Estou aqui para te ajudar a conquistar o corpo dos seus sonhos de forma natural e saudÃ¡vel! Trabalho com os produtos mais eficazes do mercado: â€¢ SB2 Turbo - FÃ³rmula acelerada â€¢ SB2 Black - FÃ³rmula premium Qual Ã© o seu objetivo principal? 1ï¸âƒ£ Perder peso rapidamente 2ï¸âƒ£ Reduzir medidas 3ï¸âƒ£ Controlar a fome 4ï¸âƒ£ Aumentar energia e disposiÃ§Ã£o Me conte sobre vocÃª! ğŸ˜Š""" # Interesse em produtos elif any(word in message_lower for word in ['produto', 'emagrecer', 'perder peso', 'sb2', 'turbo', 'black']): return f"""Perfeito! Vou te apresentar nossos produtos campeÃµes de vendas! ğŸ† ğŸš€ **SB2 TURBO** - FÃ³rmula Acelerada â€¢ Controla o apetite naturalmente â€¢ Acelera o metabolismo â€¢ Aumenta energia e disposiÃ§Ã£o â€¢ Resultados em 15 dias â€¢ PreÃ§o promocional: 12x no cartÃ£o ğŸ–¤ **SB2 BLACK** - FÃ³rmula Premium â€¢ FÃ³rmula mais concentrada â€¢ Queima gordura localizada â€¢ Reduz medidas rapidamente â€¢ Includes e-books exclusivos â€¢ Grupo VIP de acompanhamento Qual desperta mais seu interesse? Digite 1 para SB2 Turbo ou 2 para SB2 Black""" # SB2 Turbo elif '1' in message_text or 'turbo' in message_lower: return f"""Excelente escolha! ğŸš€ O SB2 Turbo Ã© nosso bestseller! âœ¨ **PRINCIPAIS BENEFÃCIOS:** â€¢ Controle total da fome e compulsÃ£o â€¢ Acelera metabolismo em atÃ© 300% â€¢ Aumenta energia naturalmente â€¢ Reduz medidas de forma acelerada â€¢ Ingredientes 100% naturais ğŸ¯ **RESULTADOS COMPROVADOS:** â€¢ 95% dos usuÃ¡rios perdem peso nos primeiros 15 dias â€¢ ReduÃ§Ã£o mÃ©dia de 3-5kg no primeiro mÃªs â€¢ Maior disposiÃ§Ã£o e energia ğŸ’° **OFERTA ESPECIAL:** â€¢ Parcelamento em 12x sem juros â€¢ Frete grÃ¡tis para todo Brasil â€¢ Garantia de 90 dias Quer garantir o seu SB2 Turbo agora? {AFFILIATE_LINKS['sb2_turbo']} Clique no link e aproveite! ğŸ”—""" # SB2 Black elif '2' in message_text or 'black' in message_lower: return f"""Perfeita escolha! ğŸ–¤ O SB2 Black Ã© nossa fÃ³rmula premium! ğŸ† **FÃ“RMULA PREMIUM:** â€¢ ConcentraÃ§Ã£o 2x mais potente â€¢ Queima gordura localizada â€¢ Reduz medidas rapidamente â€¢ Firmeza e elasticidade da pele â€¢ Resultados em 7 dias ğŸ **BÃ”NUS EXCLUSIVOS:** â€¢ 2 E-books de emagrecimento â€¢ Grupo VIP com desafio 21 dias â€¢ Acompanhamento personalizado â€¢ Dicas diÃ¡rias de motivaÃ§Ã£o ğŸ’ **INVESTIMENTO:** â€¢ Desconto especial hoje â€¢ Parcelamento facilitado â€¢ Garantia total de resultados EstÃ¡ pronta para a transformaÃ§Ã£o? {AFFILIATE_LINKS['sb2_black']} Clique e garante jÃ¡ o seu! ğŸ”—""" # DÃºvidas sobre seguranÃ§a elif any(word in message_lower for word in ['seguro', 'efeito colateral', 'natural', 'anvisa']): return f"""Pode ficar tranquila! ğŸ˜Š Nossa prioridade Ã© sua seguranÃ§a! ğŸ›¡ï¸ **SEGURANÃ‡A GARANTIDA:** â€¢ Produtos 100% naturais â€¢ Aprovados pela ANVISA â€¢ Sem efeitos colaterais â€¢ Testados clinicamente â€¢ Milhares de clientes satisfeitas ğŸŒ¿ **INGREDIENTES NATURAIS:** â€¢ ColÃ¡geno hidrolisado â€¢ Psyllium (fibra natural) â€¢ Spirulina (superalimento) â€¢ Sem quÃ­micos artificiais ğŸ“‹ **CONTRAINDICAÃ‡Ã•ES:** â€¢ Gestantes e lactantes â€¢ Menores de 18 anos â€¢ Pessoas com alergia a algum componente Qual produto desperta seu interesse? 1ï¸âƒ£ SB2 Turbo 2ï¸âƒ£ SB2 Black""" # PreÃ§os elif any(word in message_lower for word in ['preÃ§o', 'valor', 'quanto custa', 'promoÃ§Ã£o']): return f"""Ã“tima pergunta! ğŸ’° Temos condiÃ§Ãµes especiais! ğŸš€ **SB2 TURBO:** â€¢ De R$ 1.014,00 por apenas 12x no cartÃ£o â€¢ Frete GRÃTIS â€¢ Garantia de 90 dias ğŸ–¤ **SB2 BLACK:** â€¢ PreÃ§o promocional especial â€¢ Parcelamento facilitado â€¢ BÃ´nus exclusivos inclusos ğŸ¯ **OFERTA RELÃ‚MPAGO:** â€¢ Desconto especial hoje â€¢ Ãšltimas unidades â€¢ Parcelamento sem juros Qual vocÃª escolhe para comeÃ§ar hoje? SB2 Turbo: {AFFILIATE_LINKS['sb2_turbo']} SB2 Black: {AFFILIATE_LINKS['sb2_black']}""" # ObjeÃ§Ãµes comuns elif any(word in message_lower for word in ['caro', 'pensar', 'depois', 'nÃ£o tenho dinheiro']): return f"""Entendo perfeitamente! ğŸ’ Vou te ajudar a ver o valor real! ğŸ’¡ **PENSE ASSIM:** â€¢ Quanto vocÃª gasta por mÃªs com coisas desnecessÃ¡rias? â€¢ Qual o valor da sua autoestima? â€¢ Quanto vale sua saÃºde e bem-estar? ğŸ“Š **COMPARAÃ‡ÃƒO:** â€¢ Academia: R$ 100/mÃªs = R$ 1.200/ano â€¢ Nutricionista: R$ 200/consulta â€¢ Nosso produto: Menos de R$ 3/dia ğŸ **FACILIDADES:** â€¢ Parcelamento em 12x sem juros â€¢ Garantia total de 90 dias â€¢ Se nÃ£o funcionar, devolvemos seu dinheiro â° **URGÃŠNCIA:** Esta promoÃ§Ã£o acaba hoje! NÃ£o perca a chance de transformar sua vida! Qual produto vocÃª escolhe? {AFFILIATE_LINKS['sb2_turbo']} - SB2 Turbo {AFFILIATE_LINKS['sb2_black']} - SB2 Black""" # Depoimentos elif any(word in message_lower for word in ['depoimento', 'funciona', 'resultado', 'prova']): return f"""Claro! ğŸŒŸ Nossos resultados falam por si! ğŸ‘¥ **DEPOIMENTOS REAIS:** ğŸ’¬ "Perdi 8kg em 2 meses com SB2 Turbo! Me sinto outra pessoa!" - Maria, 34 anos ğŸ’¬ "SB2 Black mudou minha vida! 12kg a menos e muito mais disposiÃ§Ã£o!" - Ana, 28 anos ğŸ’¬ "Finalmente encontrei algo que funciona! Recomendo para todas!" - Carla, 41 anos ğŸ“ˆ **NÃšMEROS COMPROVADOS:** â€¢ 95% de satisfaÃ§Ã£o dos clientes â€¢ Mais de 50.000 pessoas transformadas â€¢ 4.8 estrelas de avaliaÃ§Ã£o mÃ©dia ğŸ† **RESULTADOS MÃ‰DIOS:** â€¢ 3-5kg no primeiro mÃªs â€¢ ReduÃ§Ã£o de 2-3 manequins â€¢ Mais energia e disposiÃ§Ã£o Pronta para ser a prÃ³xima histÃ³ria de sucesso? {AFFILIATE_LINKS['sb2_turbo']} - SB2 Turbo {AFFILIATE_LINKS['sb2_black']} - SB2 Black""" # Mensagem padrÃ£o else: return f"""Obrigada por me procurar! ğŸ˜Š Sou a Dany, sua especialista em emagrecimento! Estou aqui para te ajudar a conquistar o corpo dos seus sonhos! ğŸ¯ **Como posso te ajudar?** â€¢ Produtos para emagrecimento â€¢ Dicas de alimentaÃ§Ã£o â€¢ Plano personalizado â€¢ Acompanhamento completo ğŸ’ª **Nossos produtos:** â€¢ SB2 Turbo - FÃ³rmula acelerada â€¢ SB2 Black - FÃ³rmula premium Digite sua dÃºvida ou interesse que vou te ajudar pessoalmente! {AFFILIATE_LINKS['sb2_turbo']} - SB2 Turbo {AFFILIATE_LINKS['sb2_black']} - SB2 Black""" # Rota para verificaÃ§Ã£o do webhook @app.route('/webhook', methods=['GET']) def verify_webhook(): """VerificaÃ§Ã£o do webhook pelo Facebook""" try: mode = request.args.get('hub.mode') token = request.args.get('hub.verify_token') challenge = request.args.get('hub.challenge') log_message(f"VerificaÃ§Ã£o webhook - Mode: {mode}, Token: {token}") if mode == 'subscribe' and token == WEBHOOK_VERIFY_TOKEN: log_message("Webhook verificado com sucesso!") return challenge else: log_message("Falha na verificaÃ§Ã£o do webhook", "ERROR") return "Forbidden", 403 except Exception as e: log_message(f"Erro na verificaÃ§Ã£o: {str(e)}", "ERROR") return "Internal Server Error", 500 # Rota para receber mensagens @app.route('/webhook', methods=['POST']) def handle_webhook(): """Processa mensagens recebidas do WhatsApp""" try: data = request.get_json() log_message(f"Webhook recebido: {json.dumps(data, indent=2)}") if data.get('object') == 'whatsapp_business_account': entries = data.get('entry', []) for entry in entries: changes = entry.get('changes', []) for change in changes: if change.get('field') == 'messages': messages = change.get('value', {}).get('messages', []) for message in messages: sender = message.get('from') message_text = message.get('text', {}).get('body', '') message_type = message.get('type') log_message(f"Mensagem de {sender}: {message_text}") if message_type == 'text' and message_text: # Processar mensagem com a Dany response = process_dany_message(sender, message_text) if response: send_whatsapp_message(sender, response) log_message(f"Resposta enviada para {sender}") return jsonify({"status": "success"}), 200 except Exception as e: log_message(f"Erro no webhook: {str(e)}", "ERROR") return jsonify({"error": str(e)}), 500 # Rota de saÃºde @app.route('/health', methods=['GET']) def health_check(): """VerificaÃ§Ã£o de saÃºde da aplicaÃ§Ã£o""" return jsonify({ "status": "healthy", "timestamp": datetime.now().isoformat(), "webhook_token": WEBHOOK_VERIFY_TOKEN, "whatsapp_number": WHATSAPP_NUMBER }) # Rota raiz @app.route('/') def index(): """PÃ¡gina inicial da aplicaÃ§Ã£o""" return jsonify({ "message": "Dany WhatsApp Bot estÃ¡ funcionando!", "status": "active", "endpoints": { "webhook": "/webhook", "health": "/health" } }) if __name__ == '__main__': port = int(os.environ.get('PORT', 10000)) app.run(host='0.0.0.0', port=port, debug=False)
